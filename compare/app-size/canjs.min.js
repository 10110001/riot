(function(){"use strict";$(function(){can.route(":filter");can.route.ready(false);Mustache.registerHelper("plural",function(t,e){return t+(e!==1?"s":"")});Models.Todo.findAll({},function(t){new Todos("#todoapp",{todos:t,state:can.route,view:"views/todos.mustache"})});can.route.ready(true)})})();(function(t,e,n){t.view.ext=".mustache";var o=function(e){return t.isFunction(e.attr)&&e.constructor&&!!e.constructor.canMakeObserve},r=function(t){return t&&t.splice&&"number"==typeof t.length},s=function(e){if(this.constructor!=s){var n=new s(e);return function(t){return n.render(t)}}"function"==typeof e?this.template={fn:e}:(t.extend(this,e),this.template=this.scanner.scan(this.text,this.name))};t.Mustache=e.Mustache=s;s.prototype.render=function(t){t=t||{};return this.template.fn.call(t,t,{_data:t})};t.extend(s.prototype,{scanner:new t.view.Scanner({text:{start:"var ___c0nt3xt = []; ___c0nt3xt.___st4ck = true;var ___st4ck = function(context, self) {var s;if (arguments.length == 1 && context) {s = !context.___st4ck ? [context] : context;} else {s = context && context.___st4ck ? context.concat([self]) : ___st4ck(context).concat([self]);}return (s.___st4ck = true) && s;};"},tokens:[["returnLeft","{{{","{{[{&]"],["commentFull","{{!}}","^[\\s\\t]*{{!.+?}}\\n"],["commentLeft","{{!","(\\n[\\s\\t]*{{!|{{!)"],["escapeFull","{{}}","(^[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}$)",function(t){return{before:/^\n.+?\n$/.test(t)?"\n":"",content:t.match(/\{\{(.+?)\}\}/)[1]||""}}],["escapeLeft","{{"],["returnRight","}}}"],["right","}}"]],helpers:[{name:/^>[\s|\w]\w*/,fn:function(e){return"can.view.render('"+t.trim(e.replace(/^>\s?/,""))+"', ___st4ck(___c0nt3xt,this).pop())"}},{name:/^\s?data\s/,fn:function(t){return"can.proxy(function(__){can.data(can.$(__),'"+t.replace(/(^\s?data\s)|(["'])/g,"")+"', this.pop()); }, ___st4ck(___c0nt3xt,this))"}},{name:/^.*$/,fn:function(e,n){var o=!1,r=[],e=t.trim(e);if(e.length&&(o=e.match(/^([#^/]|else$)/))){o=o[0];switch(o){case"#":case"^":r.push(n.insert+"can.view.txt(0,'"+n.tagName+"',"+n.status+",this,function(){ return ");break;case"/":return{raw:'return ___v1ew.join("");}}])}));'}}e=e.substring(1)}if("else"!=o){var s=[],c=0,i=!1,a,u;(t.trim(e)+" ").replace(/((([^\s]+?=)?('.*?'|".*?"))|.*?)\s/g,function(t,e){s.push(e)});for(r.push("can.Mustache.txt(___st4ck(___c0nt3xt,this),"+(o?'"'+o+'"':"null")+",");a=s[c];c++)c&&r.push(","),c&&(u=a.match(/^(('.*?'|".*?"|[0-9.]+|true|false)|((.+?)=(('.*?'|".*?"|[0-9.]+|true|false)|(.+))))$/))?u[2]?r.push(u[0]):(i||(i=!0,r.push("{___h4sh:{")),r.push(u[4],":",u[6]?u[6]:'can.Mustache.get("'+u[5].replace(/"/g,'\\"')+'",___st4ck(___c0nt3xt,this))'),c==s.length-1&&r.push("}}")):r.push('can.Mustache.get("'+a.replace(/"/g,'\\"')+'",___st4ck(___c0nt3xt,this)'+(0==c&&1<s.length?",true":"")+")")}o&&"else"!=o&&r.push(",[{_:function(){");switch(o){case"#":r.push('return ___v1ew.join("");}},{fn:function(___c0nt3xt){var ___v1ew = [];');break;case"else":case"^":r.push('return ___v1ew.join("");}},{inverse:function(___c0nt3xt){var ___v1ew = [];');break;default:r.push(");")}r=r.join("");return o?{raw:r}:r}}]})});for(var e=t.view.Scanner.prototype.helpers,c=0;c<e.length;c++)s.prototype.scanner.helpers.unshift(e[c]);s.registerHelper=function(t,e){this._helpers.push({name:t,fn:e})};s.getHelper=function(t){for(var e=0,n;n=this._helpers[e];e++)if(n.name==t)return n;return null};s.txt=function(e,o,c){var i=Array.prototype.slice.call(arguments,3),a=t.extend.apply(t,[{fn:function(){},inverse:function(){}}].concat(o?i.pop():[])),u=i.length?i:[c],f=!0,l=[],h;if(o)for(h=0;h<u.length;h++)f=r(u[h])?"#"==o?f&&!!u[h].length:"^"==o?f&&!u[h].length:f:"#"==o?f&&!!u[h]:"^"==o?f&&!u[h]:f;if(u=s.getHelper(c)||t.isFunction(c)&&{fn:c}){e=e.___st4ck&&e[e.length-1]||e;a={fn:t.proxy(a.fn,e),inverse:t.proxy(a.inverse,e)};if((f=i[i.length-1])&&f.___h4sh)a.hash=i.pop().___h4sh;i.push(a);return u.fn.apply(e,i)||""}if(f)switch(o){case"#":if(r(c)){for(h=0;h<c.length;h++)l.push(a.fn.call(c[h]||{},e)||"");return l.join("")}return a.fn.call(c||{},e)||"";case"^":return a.inverse.call(c||{},e)||"";default:return""+(c!==n?c:"")}return""};s.get=function(e,c,i){var a=e.split("."),u=c[c.length-1],f=c[c.length-2],l,h,p;if(/^\.|this$/.test(e)){if(/^object|undefined$/.test(typeof f)){for(;i=c.pop();)if("undefined"!==typeof i)return i;return""}return f||""}if(!i)for(f=c.length-1;0<=f;f--){i=c[f];if(i!==n)for(p=0;p<a.length;p++)if("undefined"!=typeof i[a[p]])l=i,i=i[h=a[p]];else{o(i)?(l=i,h=a[p]):l=i=n;break}if(i!==n){if(t.isFunction(l[h]))return l[h]();if(o(l))return l.attr(h);o(i)&&r(i)&&i.attr("length");return i}}return u!==n&&t.isFunction(u[e])?u[e]:s.getHelper(e)?e:""};s._helpers=[{name:"if",fn:function(t,e){return t?e.fn(this):e.inverse(this)}},{name:"unless",fn:function(t,e){if(!t)return e.fn(this)}},{name:"each",fn:function(t,e){if(t&&t.length){for(var n=[],o=0;o<t.length;o++)n.push(e.fn(t[o]));return n.join("")}}},{name:"with",fn:function(t,e){if(t)return e.fn(t)}}];t.view.register({suffix:"mustache",contentType:"x-mustache-template",script:function(t,e){return"can.Mustache(function(_CONTEXT,_VIEW) { "+new s({text:e,name:t}).template.out+" })"},renderer:function(t,e){return s({text:e,name:t})}})})(can,this);(function(t,e){"use strict";var n=can.Model.LocalStorage({storageName:"todos-canjs"},{matches:function(){var t=can.route.attr("filter");return!t||t==="active"&&!this.attr("complete")||t==="completed"&&this.attr("complete")}});n.List=can.Model.List({completed:function(){var t=0;this.each(function(e){t+=e.attr("complete")?1:0});return t},remaining:function(){return this.attr("length")-this.completed()},allComplete:function(){return this.attr("length")===this.completed()}});t.Models=t.Models||{};t.Models.Todo=n})(this);(function(t,e){"use strict";var n=13;var o=can.Control({defaults:{view:"views/todos.ejs"}},{init:function(){this.element.append(can.view(this.options.view,this.options))},"#new-todo keyup":function(t,e){var o=can.trim(t.val());if(e.keyCode===n&&o!==""){new Models.Todo({text:o,complete:false}).save(function(){t.val("")})}},"{Models.Todo} created":function(t,e,n){this.options.todos.push(n);this.options.state.attr("filter","")},"{state} change":function(){this.element.find("#filters").find("a").removeClass("selected").end().find('[href="'+window.location.hash+'"]').addClass("selected")},".todo dblclick":function(t){t.data("todo").attr("editing",true).save(function(){t.children(".edit").focus()})},updateTodo:function(t){var e=can.trim(t.val()),n=t.closest(".todo").data("todo");if(!n){return}if(e===""){n.destroy()}else{n.attr({editing:false,text:e}).save()}},".todo .edit keyup":function(t,e){if(e.keyCode===n){this.updateTodo(t)}},".todo .edit focusout":"updateTodo",".todo .toggle click":function(t){t.closest(".todo").data("todo").attr("complete",t.is(":checked")).save()},".todo .destroy click":function(t){t.closest(".todo").data("todo").destroy()},"#toggle-all click":function(t){var e=t.prop("checked");can.each(this.options.todos,function(t){t.attr("complete",e).save()})},"#clear-completed click":function(){for(var t=this.options.todos.length-1,e;t>-1&&(e=this.options.todos[t]);t--){if(e.attr("complete")){e.destroy()}}}});t.Todos=o})(this);