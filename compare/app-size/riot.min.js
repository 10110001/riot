function Todo(t){t=t||DB("todo-riot");var e=$.observable(this),o=t.get();e.add=function(t){var i={id:"_"+(""+Math.random()).slice(2),name:t};o[i.id]=i;e.emit("add",i)};e.edit=function(t){o[t.id]=t;e.emit("edit",t)};e.remove=function(t){var i=e.items(t);$.each(i,function(){delete o[this.id]});e.emit("remove",i)};e.toggle=function(t){var i=o[t];i.done=!i.done;e.emit("toggle",i)};e.items=function(t){var e=[];$.each(o,function(o,i){if(!t||t==o||t==(i.done?"completed":"active"))e.push(i)});return e};e.on("add remove toggle edit",function(){t.put(o)})}(function(){"use strict";window.todo=new Todo;var t=$("[type='html/todo']").html(),e=$("#todo-list"),o=$("#filters a");$("#new-todo").keyup(function(t){var e=$.trim(this.value);if(t.which==13&&e){todo.add(e);this.value=""}});$("#toggle-all").click(function(){$("li",e).each(function(){todo.toggle(this.id)})});$("#clear-completed").click(function(){todo.remove("completed")});todo.on("add",n).on("remove",function(t){$.each(t,function(){$("#"+this.id).remove()})}).on("toggle",function(t){i($("#"+t.id),!!t.done)}).on("edit",function(t){var e=$(t.id);e.removeClass("editing");$("label, .edit",e).text(t.name).val(t.name)}).on("add remove toggle",d);o.click(function(){return $.route($(this).attr("href"))});$.route(function(t){e.empty()&&$.each(todo.items(t.slice(2)),n);o.removeClass("selected").filter("[href='"+t+"']").addClass("selected");d()});function i(t,e){t.toggleClass("completed",e);$(":checkbox",t).prop("checked",e)}function n(o){if(this.id)o=this;var n=$.el(t,o).appendTo(e),d=$(".edit",n);$(".toggle",n).click(function(){todo.toggle(o.id)});i(n,!!o.done);d.keydown(function(t){var e=$.trim(this.value);if(t.which==13&&e){o.name=e;todo.edit(o)}});$("label",n).dblclick(function(){n.addClass("editing");d.focus()[0].select()});$(".destroy",n).click(function(){todo.remove(o.id)})}function d(){var t=todo.items("active").length,e=todo.items("completed").length;$("#todo-count").html("<strong>"+t+"</strong> item"+(t==1?"":"s")+" left");$("#clear-completed").toggle(e>0).text("Clear completed ("+e+")");$("#footer").toggle(t+e>0)}})();function DB(t){var e=window.localStorage;return{get:function(){return JSON.parse(e[t]||"{}")},put:function(o){e[t]=JSON.stringify(o)}}}